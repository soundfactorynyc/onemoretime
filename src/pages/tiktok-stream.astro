---
// Sound Factory NYC - TikTok Stream with Advanced Player
import BlackGrid from '../components/BlackGrid.astro';
import SimpleReactionSystem from '../components/dynamic/reactions/SimpleReactionSystem.astro';
import SimpleGroupChat from '../components/SimpleGroupChat.astro';
import NextLevelTikTokPlayer from '../components/NextLevelTikTokPlayer.jsx';
---

<html lang="en">
<head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>Sound Factory NYC - Live Stream</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html, body {
            position: fixed;
            width: 100%;
            height: 100%;
            background: #000000;
            color: #ffffff;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* Prevent pull-to-refresh on mobile */
        body {
            overscroll-behavior-y: none;
        }
        
        /* TikTok-style gradient background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, rgba(255, 0, 110, 0.05) 0%, rgba(0, 0, 0, 1) 70%);
            z-index: -1;
            pointer-events: none;
        }
        
    </style>
</head>
<body>


    <!-- Full Screen Grid Overlay -->
    <div id="fullGridOverlay" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.95); z-index: 2000; display: none; backdrop-filter: blur(20px);">
        <div style="position: relative; width: 100%; height: 100%;">
            <!-- Close Grid Button -->
            <button id="closeGrid" style="position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 12px; border-radius: 50%; font-size: 18px; cursor: pointer; backdrop-filter: blur(10px); z-index: 2001; width: 44px; height: 44px; display: flex; align-items: center; justify-content: center;">
                Ã—
            </button>
            
            <!-- Grid Title -->
            <div id="gridTitle" style="position: absolute; top: 20px; left: 20px; color: white; font-size: 16px; font-weight: bold; z-index: 2001; background: rgba(0,0,0,0.5); padding: 8px 16px; border-radius: 8px; backdrop-filter: blur(10px);">
                Sound Factory Grid
            </div>
            
            <!-- Full Grid Container -->
            <div id="fullGridContainer" style="width: 100%; height: 100%; padding: 80px 20px 20px;">
                <BlackGrid 
                    wsUrl="ws://localhost:8080"
                    ledRows={64}
                    ledCols={64}
                />
            </div>
        </div>
    </div>

    <!-- NEXT LEVEL TIKTOK PLAYER (Full Screen) -->
    <div style="position: fixed; top: 0; left: 0; right: 0; height: 100vh; z-index: 500;">
        <NextLevelTikTokPlayer client:load />
    </div>
    
    <!-- SIMPLE REACTION SYSTEM - TikTok Style -->
    <SimpleReactionSystem />

    <!-- SIMPLE GROUP CHAT - TikTok Comments Style -->
    <SimpleGroupChat />

    <script>
        // Grid overlay functionality
        const fullGridOverlay = document.getElementById('fullGridOverlay');
        const closeGridBtn = document.getElementById('closeGrid');
        
        // Close grid overlay
        if (closeGridBtn) {
            closeGridBtn.addEventListener('click', () => {
                if (fullGridOverlay) {
                    fullGridOverlay.style.opacity = '0';
                    setTimeout(() => {
                        fullGridOverlay.style.display = 'none';
                    }, 300);
                }
            });
        }
        
        // Close on overlay click (outside grid)
        if (fullGridOverlay) {
            fullGridOverlay.addEventListener('click', (e) => {
                if (e.target === fullGridOverlay && closeGridBtn) {
                    closeGridBtn.click();
                }
            });
            
            // Initialize overlay styles
            fullGridOverlay.style.opacity = '0';
            fullGridOverlay.style.transition = 'opacity 0.3s ease';
        }
    </script>
</body>
</html>
